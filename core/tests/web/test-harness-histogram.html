<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histogram Visualization Test Harness</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .histogram-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .histogram-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .histogram-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }
        canvas {
            border: 1px solid #ddd;
            display: block;
            margin: 0 auto;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-info { color: #6c757d; }
        textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Histogram Visualization Test Harness</h1>
        
        <div class="controls">
            <h3>Controls</h3>
            <button onclick="generateAllHistograms()">Generate All Histograms</button>
            <button onclick="clearLog()">Clear Log</button>
            <button onclick="downloadPNG('normal-distribution')">Download Normal PNG</button>
            <button onclick="downloadPNG('uniform-distribution')">Download Uniform PNG</button>
            
            <h4>Custom Code Execution</h4>
            <textarea id="customCode" placeholder="Enter JavaScript code here...">
// Example: Generate custom histogram
const customData = Array.from({length: 100}, () => Math.random() * 50 + 25);
const hist = generateHistogram(customData, {
  main: 'Custom Distribution',
  col: 'purple',
  breaks: 15
});
renderHistogramToCanvas(hist, 'custom-histogram');</textarea>
            <button onclick="executeCustomCode()">Execute Custom Code</button>
            
            <div id="log" class="log"></div>
        </div>

        <div class="histogram-grid">
            <div class="histogram-card">
                <div class="histogram-title">Normal Distribution (μ=100, σ=15)</div>
                <canvas id="normal-distribution" width="400" height="300"></canvas>
            </div>
            
            <div class="histogram-card">
                <div class="histogram-title">Uniform Distribution [25, 75]</div>
                <canvas id="uniform-distribution" width="400" height="300"></canvas>
            </div>
            
            <div class="histogram-card">
                <div class="histogram-title">Exponential Distribution (λ=0.5)</div>
                <canvas id="exponential-distribution" width="400" height="300"></canvas>
            </div>
            
            <div class="histogram-card">
                <div class="histogram-title">Bimodal Distribution</div>
                <canvas id="bimodal-distribution" width="400" height="300"></canvas>
            </div>
            
            <div class="histogram-card">
                <div class="histogram-title">Small Dataset (n=12)</div>
                <canvas id="small-dataset" width="400" height="300"></canvas>
            </div>
            
            <div class="histogram-card">
                <div class="histogram-title">Constant Values (all = 42)</div>
                <canvas id="constant-values" width="400" height="300"></canvas>
            </div>

            <!-- Custom histogram area -->
            <div class="histogram-card">
                <div class="histogram-title">Custom Beta-like Distribution</div>
                <canvas id="custom-histogram" width="400" height="300"></canvas>
            </div>
        </div>
    </div>

    <script src="../histogram-browser-renderer.js"></script>
    <script>
        // Test harness functionality
        let logCount = 0;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${++logCount}] ${new Date().toLocaleTimeString()} - ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logCount = 0;
            log('Log cleared', 'info');
        }

        function generateAllHistograms() {
            log('Generating all histograms...', 'info');
            
            try {
                // 1. Normal Distribution
                log('Creating normal distribution...', 'info');
                const normalData = [];
                for (let i = 0; i < 1000; i++) {
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                    normalData.push(z0 * 15 + 100);
                }
                const normalHist = generateHistogram(normalData, {
                    main: 'Normal Distribution (μ=100, σ=15)',
                    xlab: 'Value',
                    ylab: 'Frequency',
                    col: 'steelblue',
                    breaks: 25
                });
                renderHistogramToCanvas(normalHist, 'normal-distribution');
                log('✅ Normal distribution rendered', 'success');

                // 2. Uniform Distribution
                log('Creating uniform distribution...', 'info');
                const uniformData = Array.from({length: 800}, () => Math.random() * 50 + 25);
                const uniformHist = generateHistogram(uniformData, {
                    main: 'Uniform Distribution [25, 75]',
                    xlab: 'Value',
                    ylab: 'Frequency',
                    col: 'lightgreen',
                    breaks: 20
                });
                renderHistogramToCanvas(uniformHist, 'uniform-distribution');
                log('✅ Uniform distribution rendered', 'success');

                // 3. Exponential Distribution
                log('Creating exponential distribution...', 'info');
                const exponentialData = [];
                for (let i = 0; i < 500; i++) {
                    const lambda = 0.5;
                    const u = Math.random();
                    const exp = -Math.log(u) / lambda;
                    exponentialData.push(exp);
                }
                const expHist = generateHistogram(exponentialData, {
                    main: 'Exponential Distribution (λ=0.5)',
                    xlab: 'Value',
                    ylab: 'Frequency',
                    col: 'orange',
                    breaks: 15
                });
                renderHistogramToCanvas(expHist, 'exponential-distribution');
                log('✅ Exponential distribution rendered', 'success');

                // 4. Bimodal Distribution
                log('Creating bimodal distribution...', 'info');
                const bimodalData = [];
                for (let i = 0; i < 300; i++) {
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                    bimodalData.push(z0 * 5 + 20);
                }
                for (let i = 0; i < 200; i++) {
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                    bimodalData.push(z0 * 3 + 60);
                }
                const bimodalHist = generateHistogram(bimodalData, {
                    main: 'Bimodal Distribution',
                    xlab: 'Value',
                    ylab: 'Frequency',
                    col: 'purple',
                    breaks: 30
                });
                renderHistogramToCanvas(bimodalHist, 'bimodal-distribution');
                log('✅ Bimodal distribution rendered', 'success');

                // 5. Small Dataset
                log('Creating small dataset...', 'info');
                const smallData = [1, 1, 2, 2, 2, 3, 3, 3, 3, 4, 4, 5];
                const smallHist = generateHistogram(smallData, {
                    main: 'Small Dataset (n=12)',
                    xlab: 'Value',
                    ylab: 'Count',
                    col: 'lightcoral',
                    breaks: 5
                });
                renderHistogramToCanvas(smallHist, 'small-dataset');
                log('✅ Small dataset rendered', 'success');

                // 6. Constant Values
                log('Creating constant values...', 'info');
                const constantData = Array(20).fill(42);
                const constantHist = generateHistogram(constantData, {
                    main: 'Constant Values (all = 42)',
                    xlab: 'Value',
                    ylab: 'Count',
                    col: 'gold'
                });
                renderHistogramToCanvas(constantHist, 'constant-values');
                log('✅ Constant values rendered', 'success');

                // 7. Custom Example (Beta Distribution approximation)
                log('Creating custom distribution example...', 'info');
                const customData = [];
                for (let i = 0; i < 400; i++) {
                    // Approximate beta distribution using transformation
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const beta = Math.pow(u1, 1/2) / (Math.pow(u1, 1/2) + Math.pow(u2, 1/3));
                    customData.push(beta * 100); // Scale to 0-100
                }
                const customHist = generateHistogram(customData, {
                    main: 'Custom Beta-like Distribution',
                    xlab: 'Percentage',
                    ylab: 'Frequency',
                    col: 'mediumpurple',
                    border: 'indigo',
                    breaks: 18
                });
                renderHistogramToCanvas(customHist, 'custom-histogram');
                log('✅ Custom distribution rendered', 'success');

                log('🎯 All histograms generated successfully!', 'success');
                
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }

        function executeCustomCode() {
            const code = document.getElementById('customCode').value;
            try {
                log('Executing custom code...', 'info');
                eval(code);
                log('✅ Custom code executed successfully', 'success');
            } catch (error) {
                log(`❌ Custom code error: ${error.message}`, 'error');
            }
        }

        function downloadPNG(canvasId) {
            const canvas = document.getElementById(canvasId);
            const link = document.createElement('a');
            link.download = `${canvasId}-histogram.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            log(`📥 Downloaded ${canvasId}-histogram.png`, 'success');
        }

        // Auto-generate on load
        window.addEventListener('load', () => {
            log('Test harness loaded', 'info');
            setTimeout(generateAllHistograms, 100);
        });
    </script>
</body>
</html>