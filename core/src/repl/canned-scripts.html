<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RexxJS Canned Scripts - REXX Examples</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            min-height: 50px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>RexxJS Canned Scripts Example</h1>
    <p>This page demonstrates using pre-written REXX scripts with various RexxJS features and output handlers.</p>
    
    <h2>Output:</h2>
    <pre id="output">Waiting for REXX to update this element...</pre>
    
    <h2>REXX SAY Output (Document Write Style):</h2>
    <div id="rexx-output-container" style="min-height: 100px; border: 1px solid #ddd; padding: 10px; background: #fafafa; border-radius: 5px;">
        <em>SAY output will appear here...</em>
    </div>
    
    <h2>Actions:</h2>
    <button id="hello-btn" onclick="runHelloWorld()" disabled>Run Hello World</button>
    <button id="time-btn" onclick="runTimeExample()" disabled>Show Current Time</button>
    <button id="counter-btn" onclick="runCounter()" disabled>Run Counter</button>
    <button onclick="clearOutput()">Clear Output</button>
    <button onclick="clearRexxOutput()">Clear REXX Output</button>
    
    <h2>REXX Script Being Executed:</h2>
    <div id="script-display" class="code-block">Script will appear here when you click a button...</div>
    
    <!-- Load the RexxJS bundle -->
    <script src="dist/rexxjs.bundle.js"></script>
    
    <!-- Load the document write styled output handler -->
    <script src="../output/document-write-styled-output-handler.js"></script>

    <!-- Load the shared demo executor -->
    <script src="demo-executor.js"></script>
    
    <!-- REXX Scripts stored in script tags with custom MIME type -->
    <script type="text/rexx" id="hello-world-script">
/* REXX Script: Hello World DOM Manipulation */

/* Use DOM_QUERY to set the text content of the pre element */
LET result = DOM_QUERY(selector="#output", operation="value", value="Hello, World from REXX!")

/* Also demonstrate using DOM_SET_STYLE to change the color */
DOM_SET_STYLE selector="#output" property="color" value="#4CAF50"
DOM_SET_STYLE selector="#output" property="fontSize" value="24px"

SAY "Updated the output element with Hello World!"
    </script>

    <script type="text/rexx" id="time-example-script">
/* REXX Script: Display Current Date/Time */

/* Get current date and time */
LET currentDate = DATE()
LET currentTime = TIME()
LET nowStr = "Current date/time: " || currentDate || " " || currentTime

/* Print to console for now (no DOM interaction) */
SAY nowStr
SAY "Time display complete - check console output"
    </script>

    <script type="text/rexx" id="counter-script-template">
/* REXX Script: Counter Example */

/* Set counter value from JavaScript */
LET count = {COUNTER_VALUE}
LET message = "Button clicked " || count || " time"
IF count > 1 THEN message = message || "s"
message = message || "!"

/* Update the display */
LET result = DOM_QUERY(selector="#output", operation="value", value=message)

/* Animated color change based on count */
IF count // 2 = 0 THEN DO
    DOM_SET_STYLE selector="#output" property="color" value="#FF9800"
END
ELSE DO
    DOM_SET_STYLE selector="#output" property="color" value="#9C27B0"
END

DOM_SET_STYLE selector="#output" property="fontSize" value="22px"
DOM_SET_STYLE selector="#output" property="transition" value="all 0.3s ease"

SAY "Counter updated to:" count
    </script>

    <script>
        let interpreter = null;
        let counter = 0;
        
        // Wait for bundle to load, then initialize
        window.addEventListener('DOMContentLoaded', async function() {
            try {
                // Check if RexxInterpreter is available from the bundle
                if (typeof RexxInterpreter === 'undefined') {
                    throw new Error('RexxInterpreter not found. Make sure repl.bundle.js is built and loaded.');
                }
                
                // Create document write styled output handler
                const outputHandler = new DocumentWriteStyledOutputHandler(true, 'rexx-output', 'rexx-output-container'); // Include timestamps, CSS class, container ID

                // Create interpreter instance with document write output using builder pattern with trace enabled
                interpreter = new RexxInterpreterBuilder(null)
                    .withOutputHandler({
                        output: (text) => {
                            outputHandler.output(text);
                        }
                    })
                .withTraceMode('NORMAL')
                    .withTraceToOutput(true)  // Enable trace mode - shows executed REXX lines
                    .build();
                
                // Enable buttons
                document.getElementById('hello-btn').disabled = false;
                document.getElementById('time-btn').disabled = false;
                document.getElementById('counter-btn').disabled = false;
                
            } catch (error) {
                console.error('Load error:', error);
            }
        });
        
        function displayScript(script) {
            document.getElementById('script-display').textContent = script;
        }
        
        function getRexxScript(scriptId) {
            const scriptElement = document.getElementById(scriptId);
            return scriptElement ? scriptElement.textContent.trim() : '';
        }
        
        async function runHelloWorld() {
            const script = getRexxScript('hello-world-script');
            displayScript(script);
            await executeRexxScript(script);
        }
        
        async function runTimeExample() {
            const script = getRexxScript('time-example-script');
            displayScript(script);
            await executeRexxScript(script);
        }
        
        async function runCounter() {
            counter++;
            const scriptTemplate = getRexxScript('counter-script-template');
            const script = scriptTemplate.replace('{COUNTER_VALUE}', counter);
            
            displayScript(script);
            await executeRexxScript(script);
        }
        
        async function executeRexxScript(scriptText) {
            if (!interpreter) {
                return;
            }
            
            try {
                
                // Parse and execute the REXX script
                const commands = parse(scriptText);
                await interpreter.run(commands);
                
            } catch (error) {
                console.error('Execution error:', error);
            }
        }
        
        function clearOutput() {
            document.getElementById('output').textContent = 'Cleared. Click a button to run a script...';
            document.getElementById('output').style = '';
            document.getElementById('script-display').textContent = 'Script will appear here when you click a button...';
            counter = 0;
        }
        
        function clearRexxOutput() {
            // Clear the REXX output container
            const container = document.getElementById('rexx-output-container');
            container.innerHTML = '<em>SAY output will appear here...</em>';
        }
    </script>
</body>
</html>