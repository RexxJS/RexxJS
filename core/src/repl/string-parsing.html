<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RexxJS String Parsing Demo</title>


    <!-- Shared demo CSS -->
    <link rel="stylesheet" href="demo-common.css">

    <!-- Load the RexxJS bundle -->
    <script src="dist/rexxjs.bundle.js"></script>

    <!-- Load the document write styled output handler -->
    <script src="../output/document-write-styled-output-handler.js"></script>

    <!-- Load the shared demo executor -->
    <script src="demo-executor.js"></script>

    <!-- REXX Script for string parsing demonstration -->
    <script type="text/rexx" id="string-parsing-script">
        /* Auto-executing REXX String Parsing Demo */

        SAY "=== REXX String Parsing Demo ==="
        SAY ""

        /* PARSE with template */
        LET data = "John Doe 35 Engineer"
        SAY "PARSE with template:"
        SAY "  Input: " || data
        PARSE VAR data firstName lastName age profession
        SAY "  firstName: " || firstName
        SAY "  lastName: " || lastName
        SAY "  age: " || age
        SAY "  profession: " || profession
        SAY ""

        /* PARSE with WORD function */
        LET sentence = "The quick brown fox jumps"
        SAY "WORD function (extract word by position):"
        SAY "  Input: " || sentence
        SAY "  WORD 1: " || WORD(sentence, 1)
        SAY "  WORD 3: " || WORD(sentence, 3)
        SAY "  WORD 5: " || WORD(sentence, 5)
        SAY "  WORDS in sentence: " || WORDS(sentence)
        SAY ""

        /* Splitting by delimiter */
        LET csv = "apple,banana,cherry,date"
        SAY "Manual splitting by comma:"
        SAY "  Input: " || csv
        LET item1 = WORD(TRANSLATE(csv, " ", ","), 1)
        SAY "  Item 1: " || item1
        LET converted = TRANSLATE(csv, " ", ",")
        SAY "  All items: " || converted
        SAY ""

        /* ABBREV function for prefix matching */
        LET command = "DELETE"
        SAY "ABBREV function (prefix matching):"
        SAY "  Command: " || command
        SAY "  ABBREV('DELETE', 'DEL') = " || ABBREV(command, "DEL")
        SAY "  ABBREV('DELETE', 'DXL') = " || ABBREV(command, "DXL")
        SAY ""

        /* POS function (alternative to INDEX) - note: parameter order is (string, needle) for piping */
        LET text = "Find the needle in the haystack"
        SAY "Position finding:"
        SAY "  Text: " || text
        SAY "  POS(text, 'needle') = " || POS(text, "needle")
        SAY "  POS(text, 'x') = " || POS(text, "x")
        SAY ""
        SAY "=== String Parsing Demo Complete ==="
    </script>

</head>
<body>
    <h1>RexxJS String Parsing Demo</h1>
    <div class="intro">
        <p><strong>Auto-executing REXX script</strong> demonstrating string parsing and extraction techniques.</p>
        <p>Covers PARSE, WORD, WORDS, TRANSLATE, ABBREV, and position-finding functions.</p>
    </div>

    <h2>REXX Output:</h2>
    <div class="output-section">

        <script>
            // Auto-execute using shared demo executor - wait for dependencies to load
            async function runDemo() {
                // Wait for all required global objects to be available
                let attempts = 0;
                while ((typeof executeRexxDemo === 'undefined' || typeof RexxInterpreterBuilder === 'undefined') && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (typeof executeRexxDemo === 'undefined') {
                    console.error('executeRexxDemo not found after 5 seconds');
                    return;
                }

                try {
                    await executeRexxDemo('string-parsing-script', {
                        traceMode: 'NORMAL',
                        traceToOutput: true
                    });
                } catch (error) {
                    console.error('Failed to execute demo:', error);
                }
            }

            // Run when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', runDemo);
            } else {
                runDemo();
            }
        </script>
    </div>

    <h2>String Parsing Functions</h2>
    <ul>
        <li><strong>PARSE VAR</strong> - Splits a variable into components based on whitespace or explicit patterns</li>
        <li><strong>WORD(string, n)</strong> - Extracts the nth word from a string (words separated by spaces)</li>
        <li><strong>WORDS(string)</strong> - Returns the count of words in a string</li>
        <li><strong>TRANSLATE(string, tochar, fromchar)</strong> - Replaces all occurrences of fromchar with tochar</li>
        <li><strong>ABBREV(string, prefix [, length])</strong> - Tests if string starts with prefix</li>
        <li><strong>POS(substring, string)</strong> - Returns position of substring (alternative to INDEX)</li>
    </ul>

    <h2>Parsing Patterns</h2>
    <ul>
        <li><strong>By whitespace</strong> - Default behavior of PARSE, splits on any whitespace</li>
        <li><strong>By delimiter</strong> - Use TRANSLATE to convert delimiters to spaces, then PARSE</li>
        <li><strong>By position</strong> - Use SUBSTR with calculated positions</li>
        <li><strong>By pattern matching</strong> - Use INDEX/POS to find landmarks, then extract</li>
    </ul>

    <h2>Common Use Cases</h2>
    <ul>
        <li>Processing CSV or delimited data files</li>
        <li>Parsing command-line arguments</li>
        <li>Extracting fields from structured text</li>
        <li>Command abbreviation matching</li>
        <li>Log file analysis</li>
    </ul>


</body>
</html>
