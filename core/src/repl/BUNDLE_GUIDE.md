# RexxJS REPL Bundle Guide

This directory contains the webpack configuration for building bundled versions of the RexxJS interpreter for web use.

## Bundle Files

Two versions are generated by `npm run build:repl`:

### Production (Minified)
- **Filename:** `dist/rexxjs.bundle.min.js`
- **Size:** ~368 KB (gzipped: ~85 KB)
- **Use case:** Production deployment, CDN distribution
- **Benefits:**
  - Smallest file size
  - Optimal network transfer
  - Best for end-users
  - Can be cached aggressively

### Development (Unminified)
- **Filename:** `dist/rexxjs.bundle.js`
- **Size:** ~1.1 MB (gzipped: ~260 KB)
- **Use case:** Debugging, development, source inspection
- **Benefits:**
  - Readable source code
  - Easy debugging in DevTools
  - Stack traces match source
  - Better for development iteration

## Building

### Build both versions
```bash
npm run build:repl
```

**Time:** ~6.4 seconds total (minified: 5.5s, unminified: 1.5s)

### Watch mode (auto-rebuild on changes)
```bash
npm run build:repl:watch
```

## Usage

### In HTML - Production
```html
<script src="path/to/rexxjs.bundle.min.js"></script>
<script>
  const interpreter = new RexxInterpreter();
  const code = `SAY "Hello from REXX!"`;
  const commands = parse(code);
  interpreter.run(commands);
</script>
```

### In HTML - Development/Debugging
```html
<script src="path/to/rexxjs.bundle.js"></script>
<script>
  // Same usage as above, but with readable source in DevTools
</script>
```

## Architecture

### Entry Point
- **File:** `interpreter-bundle-entry.js`
- **Purpose:** Explicitly requires all 50+ modules in correct order
- **Why needed:** Webpack needs explicit require statements to bundle dependencies

### Webpack Configuration
- **File:** `webpack.config.js`
- **Pattern:** Multi-config (array of configs)
  - Config 1: Production build (minified)
  - Config 2: Development build (unminified)
- **Shared Config:** DRY principle - common settings in `sharedConfig` object

### Global Registration

Both bundles register the interpreter globally:
- `window.RexxInterpreter` - Main class
- `window.Interpreter` - Alias for compatibility
- `window.RexxInterpreterBuilder` - Builder class
- `window.parse()` - Parser function

## Bundling Details

### Size Analysis
```
Minified:    368 KB
Unminified:  1.1 MB
Ratio:       ~33% of original (67% reduction)
```

### Included Modules (50+)
- Core parsing: parser.js, parameter-converter.js, etc.
- Interpreter: interpreter-*.js modules
- Function libraries: string-functions.js, math-functions.js, etc.
- Utilities: utils.js, security.js, etc.
- DOM support: dom-functions.js, dom-element-manager.js, etc.

### Performance Impact

| Metric | Minified | Unminified |
|--------|----------|-----------|
| Network (KB) | 85 | 260 |
| Parse Time | ~100ms | ~150ms |
| Execution | Same | Same |
| Debugging | Hard | Easy |

## Recommendations

### For Production
- Use `rexxjs.bundle.min.js`
- Enable gzip compression on server
- Add far-future cache headers (1 year)
- Consider CDN distribution

### For Development
- Use `rexxjs.bundle.js` for live debugging
- Use `npm run build:repl:watch` for auto-rebuild
- Keep DevTools open to inspect errors

### For Hybrid Approach
- Deploy minified version to production
- Serve unminified version in development environment
- Use feature flags/environment detection to choose

## Why Bundled Only?

The bundled approach was chosen because:
- ✅ Simple and reliable - single HTTP request for all dependencies
- ✅ Easy cache management - version the bundle filename
- ✅ Production-ready - proven pattern across JavaScript ecosystem
- ✅ Fast rebuild with watch mode for development

The unbundled approach (loading 49+ individual modules) proved too complex to maintain in browser environments due to module dependency resolution and timing issues.

## Troubleshooting

### "RexxInterpreter is not defined"
Make sure the bundle script tag is loaded before your code tries to use it.

### Minified errors are hard to read
Use `rexxjs.bundle.js` (unminified) or enable source maps in production.

### Bundle is very large
- Verify all modules are necessary
- Consider code splitting (advanced webpack config)
- Enable gzip compression on server

## References

- Entry point: `interpreter-bundle-entry.js`
- Config: `webpack.config.js`
- Scripts: `package.json` (build:repl, build:repl:watch)
- Distribution: `dist/rexxjs.bundle.*.js`
